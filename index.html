<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Pyadjoint &mdash; Pyadjoint 0.0.1a documentation</title>
    
    <link rel="stylesheet" href="_static/readable.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.1a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Pyadjoint 0.0.1a documentation" href="#" />
    <link rel="next" title="Adjoint Sources" href="adjoint_sources/index.html" />
   
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">
  
  
  <div class="indexwrapper">
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="adjoint_sources/index.html" title="Adjoint Sources"
             accesskey="N">next</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">Pyadjoint 0.0.1a documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="pyadjoint">
<h1>Pyadjoint<a class="headerlink" href="#pyadjoint" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal"><span class="pre">Pyadjoint</span></code> is a Python package to measure misfits and calculate
adjoint sources. It aims to provide a comprehensive package and
incorporate various types of measurements and associated adjoint
sources.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">Pyadjoint</span></code> utilizes <a class="reference external" href="http://obspy.org">ObsPy</a> (and some of its
dependencies) for the processing and data handling. As a first step,
please follow the <a class="reference external" href="https://github.com/obspy/obspy/wiki#installation">installation instructions of
ObsPy</a> for your
given platform (we recommend the installation with
<a class="reference external" href="https://github.com/obspy/obspy/wiki/Installation-via-Anaconda">Anaconda</a>
as it will most likely result in the least amount of problems).
<code class="docutils literal"><span class="pre">Pyadjoint</span></code> should work with Python versions 2.7, 3.4, and 3.5. To
install it, best use <code class="docutils literal"><span class="pre">pip</span></code> (not working yet!):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ pip install pyadjoint
</pre></div>
</div>
<p>If you want the latest development version, or want to work on the code,
you will have to install with the help of <code class="docutils literal"><span class="pre">git</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ git clone https://github.com/krischer/pyadjoint.git
$ cd pyadjoint
$ pip install -v -e .
</pre></div>
</div>
</div>
<div class="section" id="tests">
<h2>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h2>
<p>To assure the installation is valid and everything works as expected,
run the tests with</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ python -m pyadjoint.tests
</pre></div>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="basic-usage">
<h3>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h3>
<p>The first step is to import ObsPy and <code class="docutils literal"><span class="pre">Pyadjoint</span></code>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">obspy</span>
<span class="kn">import</span> <span class="nn">pyadjoint</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">Pyadjoint</span></code> expects the data to be fully preprocessed thus both
observed and synthetic data are expected to have exactly the same
length, sampling rate, and spectral content. <code class="docutils literal"><span class="pre">Pyadjoint</span></code> furthermore
does not care about the actual components in question; it will use two
traces and calculate misfit values and adjoint sources for them. To
provide a familiar nomenclature we will always talk about observed and
synthetic data <code class="docutils literal"><span class="pre">Pyadjoint</span></code> is independent of what the data actually
represents.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Helper function to get some example data used for</span>
<span class="c1"># illustrative purposes.</span>
<span class="n">obs</span><span class="p">,</span> <span class="n">syn</span> <span class="o">=</span> <span class="n">pyadjoint</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_example_data</span><span class="p">()</span>
<span class="c1"># Select the vertical components of both.</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="s2">&quot;Z&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">syn</span> <span class="o">=</span> <span class="n">syn</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="s2">&quot;Z&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>Essentially all of <code class="docutils literal"><span class="pre">Pyadjoint</span></code>&#8216;s functionality is accessed through its central <a class="reference internal" href="adjoint_source.html#pyadjoint.adjoint_source.calculate_adjoint_source" title="pyadjoint.adjoint_source.calculate_adjoint_source"><code class="xref py py-func docutils literal"><span class="pre">calculate_adjoint_source()</span></code></a> function. A list of available
adjoint source types can be found in <a class="reference internal" href="adjoint_sources/index.html"><em>Adjoint Sources</em></a>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">adj_src</span> <span class="o">=</span> <span class="n">pyadjoint</span><span class="o">.</span><span class="n">calculate_adjoint_source</span><span class="p">(</span>
    <span class="c1"># The type of misfit measurement and adjoint source.</span>
    <span class="n">adj_src_type</span><span class="o">=</span><span class="s2">&quot;waveform_misfit&quot;</span><span class="p">,</span>
    <span class="c1"># Pass observed and synthetic data traces.</span>
    <span class="n">observed</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span> <span class="n">synthetic</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
    <span class="c1"># The spectral content of the data.</span>
    <span class="n">min_period</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">max_period</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
    <span class="c1"># The window borders in seconds since the first sample.</span>
    <span class="n">left_window_border</span><span class="o">=</span><span class="mf">800.0</span><span class="p">,</span>
    <span class="n">right_window_border</span><span class="o">=</span><span class="mf">900.0</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">adj_src</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>---------------------------------------------------------------------------

TypeError                                 Traceback (most recent call last)

&lt;ipython-input-3-62434aaf8cde&gt; in &lt;module&gt;()
      8     # The window borders in seconds since the first sample.
      9     left_window_border=800.0,
---&gt; 10     right_window_border=900.0)
     11 print(adj_src)


TypeError: calculate_adjoint_source() missing 2 required positional arguments: &#39;config&#39; and &#39;window&#39;
</pre></div>
</div>
<p>It returns an <a class="reference internal" href="adjoint_source.html#pyadjoint.adjoint_source.AdjointSource" title="pyadjoint.adjoint_source.AdjointSource"><code class="xref py py-class docutils literal"><span class="pre">AdjointSource</span></code></a> object.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Access misfit and adjoint sources. The misfit is a floating point number.</span>
<span class="k">print</span><span class="p">(</span><span class="n">adj_src</span><span class="o">.</span><span class="n">misfit</span><span class="p">)</span>
<span class="c1"># The adjoint source is a a numpy array.</span>
<span class="k">print</span><span class="p">(</span><span class="n">adj_src</span><span class="o">.</span><span class="n">adjoint_source</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="usage-options">
<h3>Usage Options<a class="headerlink" href="#usage-options" title="Permalink to this headline">¶</a></h3>
<p>In case one just wants to calculate the misfit value, pass
<code class="docutils literal"><span class="pre">adjoint_src=False</span></code> in which case the adjoint source will not be
calculated. This sometimes is much faster and useful for line searches
or similar endeavors.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">pyadjoint</span><span class="o">.</span><span class="n">calculate_adjoint_source</span><span class="p">(</span>
    <span class="n">adj_src_type</span><span class="o">=</span><span class="s2">&quot;waveform_misfit&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span> <span class="n">synthetic</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
    <span class="n">min_period</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">max_period</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
    <span class="n">left_window_border</span><span class="o">=</span><span class="mf">800.0</span><span class="p">,</span> <span class="n">right_window_border</span><span class="o">=</span><span class="mf">900.0</span><span class="p">,</span> <span class="n">adjoint_src</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
</pre></div>
</div>
<p>All adjoint source types can also be plotted during the calculation. The
type of plot produced depends on the type of misfit measurement and
adjoint source.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">pyadjoint</span><span class="o">.</span><span class="n">calculate_adjoint_source</span><span class="p">(</span>
    <span class="n">adj_src_type</span><span class="o">=</span><span class="s2">&quot;waveform_misfit&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span> <span class="n">synthetic</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
    <span class="n">min_period</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">max_period</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
    <span class="n">left_window_border</span><span class="o">=</span><span class="mf">800.0</span><span class="p">,</span> <span class="n">right_window_border</span><span class="o">=</span><span class="mf">900.0</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="bp">True</span><span class="p">);</span>
</pre></div>
</div>
<p>Many types of adjoint sources have additional arguments that can be passed to it. The waveform misfit adjoint source for example allows to specifiy the width and type of the taper applied to the data. Please see the documentation of the different <a class="reference internal" href="adjoint_sources/index.html"><em>Adjoint Sources</em></a> for details.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">pyadjoint</span><span class="o">.</span><span class="n">calculate_adjoint_source</span><span class="p">(</span>
    <span class="n">adj_src_type</span><span class="o">=</span><span class="s2">&quot;waveform_misfit&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span> <span class="n">synthetic</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
    <span class="n">min_period</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">max_period</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
    <span class="n">left_window_border</span><span class="o">=</span><span class="mf">800.0</span><span class="p">,</span> <span class="n">right_window_border</span><span class="o">=</span><span class="mf">900.0</span><span class="p">,</span>
    <span class="n">taper_percentage</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">taper_type</span><span class="o">=</span><span class="s2">&quot;cosine&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="saving-to-disc">
<h3>Saving to Disc<a class="headerlink" href="#saving-to-disc" title="Permalink to this headline">¶</a></h3>
<p>One of course wants to serialize the calculated adjoint sources to disc at one point in time. You need to pass the filename and the desired format as well as some format specific parameters to the <a class="reference internal" href="adjoint_source.html#pyadjoint.adjoint_source.AdjointSource.write" title="pyadjoint.adjoint_source.AdjointSource.write"><code class="xref py py-meth docutils literal"><span class="pre">write()</span></code></a> method of the <a class="reference internal" href="adjoint_source.html#pyadjoint.adjoint_source.AdjointSource" title="pyadjoint.adjoint_source.AdjointSource"><code class="xref py py-class docutils literal"><span class="pre">AdjointSource</span></code></a> object. Instead of a filename you can also pass an open file or a file-like object. Please refer to its documentation for more details.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">adj_src</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;NET.STA.CHA.adj_src&quot;</span><span class="p">,</span>
              <span class="n">format</span><span class="o">=</span><span class="s2">&quot;SPECFEM&quot;</span><span class="p">,</span> <span class="n">time_offset</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span>!head NET.STA.CHA.adj_src
!rm NET.STA.CHA.adj_src
</pre></div>
</div>
</div>
</div>
<div class="section" id="detailed-documentation">
<h2>Detailed Documentation<a class="headerlink" href="#detailed-documentation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="further-pages">
<h3>Further Pages<a class="headerlink" href="#further-pages" title="Permalink to this headline">¶</a></h3>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="adjoint_sources/index.html">Adjoint Sources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="adjoint_sources/cc_traveltime_misfit.html">Cross Correlation Traveltime Misfit</a></li>
<li class="toctree-l2"><a class="reference internal" href="adjoint_sources/multitaper_misfit.html">Multitaper Misfit</a></li>
<li class="toctree-l2"><a class="reference internal" href="adjoint_sources/waveform_misfit.html">Waveform Misfit</a></li>
<li class="toctree-l2"><a class="reference internal" href="adjoint_sources/index.html#comparative-plots-of-all-available-adjoint-sources">Comparative Plots of All Available Adjoint Sources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example_dataset.html">Example Data Set used in Pyadjoint</a><ul>
<li class="toctree-l2"><a class="reference internal" href="example_dataset.html#source-and-receiver">Source and Receiver</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_dataset.html#data">Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_dataset.html#data-processing">Data Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_dataset.html#data-plots">Data Plots</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="citations.html">Citations</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to_add_a_new_adjoint_source.html">How to Add a New Adjoint Source Type</a></li>
</ul>
</div>
</div>
<div class="section" id="api">
<h3>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h3>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="adjoint_source.html">pyadjoint.adjoint_source</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">pyadjoint.utils</a></li>
</ul>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Pyadjoint</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#tests">Tests</a></li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#basic-usage">Basic Usage</a></li>
<li><a class="reference internal" href="#usage-options">Usage Options</a></li>
<li><a class="reference internal" href="#saving-to-disc">Saving to Disc</a></li>
</ul>
</li>
<li><a class="reference internal" href="#detailed-documentation">Detailed Documentation</a><ul>
<li><a class="reference internal" href="#further-pages">Further Pages</a></li>
<li><a class="reference internal" href="#api">API</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation index</a><ul>
      <li>Next: <a href="adjoint_sources/index.html" title="next chapter">Adjoint Sources</a></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    &copy; Copyright 2015, Lion Krischer.
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.
  </div>
  
  </div>
  
  </body>
</html>